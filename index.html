<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>APA Results Generator</title>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      padding: 24px;
      line-height: 1.4;
      background: #f5f6f5;
    }
    .wrap { max-width: 880px; margin: 0 auto; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p { margin: 0 0 16px; opacity: 0.85; }
    .card { border: 1px solid #ddd; border-radius: 14px; padding: 16px; margin: 14px 0; background: #fff; }
    .grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; }
    label { display: block; font-size: 12px; opacity: 0.8; margin-bottom: 6px; }
    input, select, textarea, button {
      width: 100%; box-sizing: border-box; padding: 10px 12px; border-radius: 10px;
      border: 1px solid #ccc; font-size: 14px;
    }
    textarea { min-height: 110px; resize: vertical; }
    .row { display: flex; gap: 10px; align-items: center; }
    .row > * { flex: 1; }
    .btn { cursor: pointer; border: 1px solid #222; background: #222; color: #fff; }
    .btn.secondary { background: #fff; color: #222; }
    .hint { font-size: 12px; opacity: 0.7; margin-top: 10px; }
    .hide { display: none; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }

    /* Logo */
    #logo {
      position: fixed;
      top: 14px;
      left: 18px;
      width: 90px; /* tweak if you want smaller/larger */
      height: auto;
      z-index: 999;
      #logo{
  position: fixed;
  top: 14px;
  left: 18px;
  width: 90px;
  height: auto;
  z-index: 999;
  filter: drop-shadow(0 6px 18px rgba(0,0,0,0.08));
  transition: transform 120ms ease;
}
#logo:hover{ transform: scale(1.02); }

@media (max-width: 640px){
  #logo{ width: 72px; top: 10px; left: 12px; }
  .wrap{ padding-top: 56px; } /* gives breathing room under the fixed logo */
}

    }
  </style>
</head>
<body>
  <img src="logo.png" id="logo" alt="The Psych Diaries logo" />

  <div class="wrap">
    <h1>APA Results Generator (7th Edition)</h1>
    <p>Choose a test, paste your numbers from STATA/output, and generate an APA-ready sentence. (Always follow your unit’s specific reporting rules.)</p>

    <div class="card">
      <div class="grid">
        <div>
          <label for="test">Test type</label>
          <select id="test">
            <option value="corr">Correlation (Pearson r)</option>
            <option value="ztest_one">Z test (one-sample)</option>
            <option value="ttest_ind">Independent samples t-test</option>
            <option value="ttest_paired">Paired-samples t-test</option>
            <option value="reg_simple">Simple linear regression</option>
          </select>
        </div>
        <div>
          <label for="style">Output style</label>
          <select id="style">
            <option value="sentence">1 sentence</option>
            <option value="mini">Mini paragraph (2–3 sentences)</option>
          </select>
        </div>
      </div>
    </div>

    <!-- Correlation -->
    <div class="card" id="panel-corr">
      <h2 style="margin:0 0 10px; font-size:16px;">Correlation (Pearson r)</h2>
      <div class="grid">
        <div>
          <label for="corr_var1">Variable 1 (name)</label>
          <input id="corr_var1" placeholder="e.g., Sleep quality" />
        </div>
        <div>
          <label for="corr_var2">Variable 2 (name)</label>
          <input id="corr_var2" placeholder="e.g., Stress" />
        </div>
        <div>
          <label for="corr_r">r value</label>
          <input id="corr_r" placeholder="e.g., 0.34 or -0.34" />
        </div>
        <div>
          <label for="corr_df">df (optional)</label>
          <input id="corr_df" placeholder="e.g., 98" />
        </div>
        <div>
          <label for="corr_n">n (optional)</label>
          <input id="corr_n" placeholder="e.g., 100" />
        </div>
        <div>
          <label for="corr_p">p (enter decimal)</label>
          <input id="corr_p" placeholder="e.g., 0.0004 or 0.043" />
        </div>
      </div>
      <div class="hint">Tip: If you enter <span class="mono">n</span>, the tool can infer df = n − 2 when df is blank.</div>
    </div>

    <!-- Z test (one-sample) -->
    <div class="card hide" id="panel-ztest_one">
      <h2 style="margin:0 0 10px; font-size:16px;">Z test (one-sample)</h2>
      <div class="grid">
        <div>
          <label for="z_dv">Outcome / measure label</label>
          <input id="z_dv" placeholder="e.g., Memory score" />
        </div>
        <div>
          <label for="z_ref">Comparison value (μ or p0)</label>
          <input id="z_ref" placeholder="e.g., 50 (population mean) or 0.50 (proportion)" />
        </div>
        <div>
          <label for="z_m">Sample mean or proportion (M or p̂)</label>
          <input id="z_m" placeholder="e.g., 53.2 or 0.62" />
        </div>
        <div>
          <label for="z_z">z value</label>
          <input id="z_z" placeholder="e.g., 2.34" />
        </div>
        <div>
          <label for="z_p">p (decimal)</label>
          <input id="z_p" placeholder="e.g., 0.019 or 0.0004" />
        </div>
        <div>
          <label for="z_n">n (optional)</label>
          <input id="z_n" placeholder="e.g., 120" />
        </div>
        <div>
          <label for="z_r">Effect size r (optional)</label>
          <input id="z_r" placeholder="e.g., 0.21" />
        </div>
      </div>
      <div class="hint">Note: This formats APA reporting. It does not compute <span class="mono">z</span> from raw data.</div>
    </div>

    <!-- Independent t-test -->
    <div class="card hide" id="panel-ttest_ind">
      <h2 style="margin:0 0 10px; font-size:16px;">Independent samples t-test</h2>
      <div class="grid">
        <div>
          <label for="t_dv">Outcome (DV) label</label>
          <input id="t_dv" placeholder="e.g., Anxiety score" />
        </div>
        <div>
          <label for="t_g1">Group 1 label</label>
          <input id="t_g1" placeholder="e.g., Control" />
        </div>
        <div>
          <label for="t_g2">Group 2 label</label>
          <input id="t_g2" placeholder="e.g., Treatment" />
        </div>
        <div>
          <label for="t_m1">Group 1 mean (M)</label>
          <input id="t_m1" placeholder="e.g., 5.20" />
        </div>
        <div>
          <label for="t_sd1">Group 1 SD</label>
          <input id="t_sd1" placeholder="e.g., 1.10" />
        </div>
        <div>
          <label for="t_m2">Group 2 mean (M)</label>
          <input id="t_m2" placeholder="e.g., 4.10" />
        </div>
        <div>
          <label for="t_sd2">Group 2 SD</label>
          <input id="t_sd2" placeholder="e.g., 1.30" />
        </div>
        <div>
          <label for="t_t">t value</label>
          <input id="t_t" placeholder="e.g., 3.12" />
        </div>
        <div>
          <label for="t_df">df</label>
          <input id="t_df" placeholder="e.g., 58" />
        </div>
        <div>
          <label for="t_p">p (decimal)</label>
          <input id="t_p" placeholder="e.g., 0.003 or 0.043" />
        </div>
        <div>
          <label for="t_d">Cohen’s d (optional)</label>
          <input id="t_d" placeholder="e.g., 0.82" />
        </div>
      </div>
    </div>

    <!-- Paired t-test -->
    <div class="card hide" id="panel-ttest_paired">
      <h2 style="margin:0 0 10px; font-size:16px;">Paired-samples t-test</h2>
      <div class="grid">
        <div>
          <label for="tp_dv">Outcome (DV) label</label>
          <input id="tp_dv" placeholder="e.g., Stress score" />
        </div>
        <div>
          <label for="tp_t1">Time/Condition 1 label</label>
          <input id="tp_t1" placeholder="e.g., Pre-test" />
        </div>
        <div>
          <label for="tp_t2">Time/Condition 2 label</label>
          <input id="tp_t2" placeholder="e.g., Post-test" />
        </div>
        <div>
          <label for="tp_m1">Condition 1 mean (M)</label>
          <input id="tp_m1" placeholder="e.g., 6.10" />
        </div>
        <div>
          <label for="tp_sd1">Condition 1 SD</label>
          <input id="tp_sd1" placeholder="e.g., 1.40" />
        </div>
        <div>
          <label for="tp_m2">Condition 2 mean (M)</label>
          <input id="tp_m2" placeholder="e.g., 5.30" />
        </div>
        <div>
          <label for="tp_sd2">Condition 2 SD</label>
          <input id="tp_sd2" placeholder="e.g., 1.20" />
        </div>
        <div>
          <label for="tp_t">t value</label>
          <input id="tp_t" placeholder="e.g., 2.75" />
        </div>
        <div>
          <label for="tp_df">df</label>
          <input id="tp_df" placeholder="e.g., 29" />
        </div>
        <div>
          <label for="tp_p">p (decimal)</label>
          <input id="tp_p" placeholder="e.g., 0.010 or 0.043" />
        </div>
        <div>
          <label for="tp_dz">Effect size dz (optional)</label>
          <input id="tp_dz" placeholder="e.g., 0.51" />
        </div>
      </div>
    </div>

    <!-- Simple regression -->
    <div class="card hide" id="panel-reg_simple">
      <h2 style="margin:0 0 10px; font-size:16px;">Simple linear regression</h2>
      <div class="grid">
        <div>
          <label for="r_dv">DV label</label>
          <input id="r_dv" placeholder="e.g., Sleep quality" />
        </div>
        <div>
          <label for="r_iv">IV label</label>
          <input id="r_iv" placeholder="e.g., Stress" />
        </div>
        <div>
          <label for="r_b">Unstandardized b</label>
          <input id="r_b" placeholder="e.g., -0.42" />
        </div>
        <div>
          <label for="r_se">SE (optional)</label>
          <input id="r_se" placeholder="e.g., 0.12" />
        </div>
        <div>
          <label for="r_t">t value</label>
          <input id="r_t" placeholder="e.g., -3.50" />
        </div>
        <div>
          <label for="r_df">df</label>
          <input id="r_df" placeholder="e.g., 98" />
        </div>
        <div>
          <label for="r_p">p (decimal)</label>
          <input id="r_p" placeholder="e.g., 0.0004 or 0.043" />
        </div>
        <div>
          <label for="r_r2">R² (optional)</label>
          <input id="r_r2" placeholder="e.g., 0.11" />
        </div>
        <div>
          <label for="r_f">F (optional)</label>
          <input id="r_f" placeholder="e.g., 12.25" />
        </div>
      </div>
      <div class="hint">Tip: Many APA write-ups include <span class="mono">b</span>, <span class="mono">SE</span>, <span class="mono">t</span>, <span class="mono">p</span>, and <span class="mono">R²</span>. Some also report a 95% CI (not included here).</div>
    </div>

    <div class="card">
      <div class="row">
        <button class="btn" id="gen">Generate</button>
        <button class="btn secondary" id="copy">Copy</button>
        <button class="btn secondary" id="clear">Clear</button>
      </div>
      <div style="margin-top:12px;">
        <label for="out">APA output</label>
        <textarea id="out" readonly></textarea>
        <div class="hint">Formatting note: italic letters are shown as plain text here (t, p, r, F, z). Italicize them in your document if required.</div>
      </div>
    </div>

    <p class="hint">Disclaimer: This tool formats text. It does not verify assumptions, correct test choice, or whether values match each other.</p>
  </div>

<script>
  const $ = (id) => document.getElementById(id);

  function showPanel(test) {
    ["corr", "ztest_one", "ttest_ind", "ttest_paired", "reg_simple"].forEach(t => {
      const panel = $("panel-" + t);
      panel.classList.toggle("hide", t !== test);
    });
  }

  function num(x) {
    if (x == null) return null;
    const s = String(x).trim();
    if (!s) return null;
    const n = Number(s);
    return Number.isFinite(n) ? n : null;
  }

  function cleanNegZero(n) {
    // Prevent "-0.00" type outputs
    return (Object.is(n, -0) || Math.abs(n) < 1e-12) ? 0 : n;
  }

  function fmtFixed(n, dp) {
    const v = num(n);
    if (v === null) return null;
    return cleanNegZero(v).toFixed(dp);
  }

  // For bounded stats like r, p, R²: remove leading zero.
  function noLeadingZero(s) {
    return String(s).replace(/^0\./, ".").replace(/^-0\./, "-.");
  }

  function fmtBounded(n, dp) {
    const s = fmtFixed(n, dp);
    if (s === null) return null;
    return noLeadingZero(s);
  }

  function fmtDfInt(x) {
    const v = num(x);
    if (v === null) return null;
    // APA: df as integer
    return String(Math.round(v));
  }

  // APA p formatting:
  // - if p < .001 => "p < .001"
  // - else => "p = .xyz" (3 dp, leading zero removed)
  function fmtP(pRaw) {
    const p = num(pRaw);
    if (p === null) return null;
    if (p < 0.001) return "p < .001";
    return "p = " + fmtBounded(p, 3);
  }

  function genCorrelation(style) {
    const v1 = $("corr_var1").value.trim() || "Variable 1";
    const v2 = $("corr_var2").value.trim() || "Variable 2";
    let df = fmtDfInt($("corr_df").value);
    const nVal = num($("corr_n").value);
    if (!df && nVal !== null) df = String(Math.round(nVal - 2));

    const r = num($("corr_r").value);
    const pText = fmtP($("corr_p").value);

    if (r === null || pText === null) return "Please enter at least r and p.";

    const rTxt = fmtBounded(r, 2); // APA: r as .xx
    const dfTxt = (df && Number(df) >= 1) ? `(${df})` : "";

    if (style === "sentence") {
      return `Pearson’s r showed an association between ${v1} and ${v2}, r${dfTxt} = ${rTxt}, ${pText}.`;
    }
    return `A Pearson correlation was conducted to examine the association between ${v1} and ${v2}. ` +
           `Results showed an association, r${dfTxt} = ${rTxt}, ${pText}.`;
  }

  function genZTestOne(style) {
    const dv = $("z_dv").value.trim() || "the outcome";
    const ref = $("z_ref").value.trim();
    const m = $("z_m").value.trim();
    const zVal = num($("z_z").value);
    const pText = fmtP($("z_p").value);
    const nVal = num($("z_n").value);
    const rEff = num($("z_r").value);

    if (!ref || !m || zVal === null || pText === null) {
      return "Please enter the sample value, comparison value, z, and p (n and effect size r are optional).";
    }

    const zTxt = fmtFixed(zVal, 2);
    const nTxt = (nVal !== null && nVal >= 1) ? `, n = ${Math.round(nVal)}` : "";
    const rTxt = (rEff !== null) ? `, r = ${fmtBounded(rEff, 2)}` : "";

    if (style === "sentence") {
      return `A one-sample z test comparing ${dv} to ${ref} yielded z = ${zTxt}, ${pText}${rTxt}${nTxt}.`;
    }
    return `A one-sample z test was conducted to compare ${dv} to ${ref}. ` +
           `The test yielded z = ${zTxt}, ${pText}${rTxt}${nTxt}.`;
  }

  function genTTestInd(style) {
    const dv = $("t_dv").value.trim() || "the outcome";
    const g1 = $("t_g1").value.trim() || "Group 1";
    const g2 = $("t_g2").value.trim() || "Group 2";
    const m1 = fmtFixed($("t_m1").value, 2);
    const sd1 = fmtFixed($("t_sd1").value, 2);
    const m2 = fmtFixed($("t_m2").value, 2);
    const sd2 = fmtFixed($("t_sd2").value, 2);
    const tVal = num($("t_t").value);
    const df = fmtDfInt($("t_df").value);
    const pText = fmtP($("t_p").value);
    const d = num($("t_d").value);

    if (tVal === null || !df || pText === null || m1 === null || sd1 === null || m2 === null || sd2 === null) {
      return "Please enter group means/SDs, t, df, and p (Cohen’s d is optional).";
    }

    const tTxt = fmtFixed(tVal, 2);
    const dTxt = (d !== null) ? `, d = ${fmtFixed(d, 2)}` : "";

    if (style === "sentence") {
      return `An independent-samples t test comparing ${dv} between ${g1} (M = ${m1}, SD = ${sd1}) and ${g2} (M = ${m2}, SD = ${sd2}) yielded t(${df}) = ${tTxt}, ${pText}${dTxt}.`;
    }
    return `An independent-samples t test was conducted to compare ${dv} between ${g1} and ${g2}. ` +
           `Scores were ${m1} (SD = ${sd1}) for ${g1} and ${m2} (SD = ${sd2}) for ${g2}. ` +
           `The test yielded t(${df}) = ${tTxt}, ${pText}${dTxt}.`;
  }

  function genTTestPaired(style) {
    const dv = $("tp_dv").value.trim() || "the outcome";
    const c1 = $("tp_t1").value.trim() || "Condition 1";
    const c2 = $("tp_t2").value.trim() || "Condition 2";
    const m1 = fmtFixed($("tp_m1").value, 2);
    const sd1 = fmtFixed($("tp_sd1").value, 2);
    const m2 = fmtFixed($("tp_m2").value, 2);
    const sd2 = fmtFixed($("tp_sd2").value, 2);
    const tVal = num($("tp_t").value);
    const df = fmtDfInt($("tp_df").value);
    const pText = fmtP($("tp_p").value);
    const dz = num($("tp_dz").value);

    if (tVal === null || !df || pText === null || m1 === null || sd1 === null || m2 === null || sd2 === null) {
      return "Please enter both condition means/SDs, t, df, and p (effect size dz is optional).";
    }

    const tTxt = fmtFixed(tVal, 2);
    const dzTxt = (dz !== null) ? `, dz = ${fmtFixed(dz, 2)}` : "";

    if (style === "sentence") {
      return `A paired-samples t test comparing ${dv} between ${c1} (M = ${m1}, SD = ${sd1}) and ${c2} (M = ${m2}, SD = ${sd2}) yielded t(${df}) = ${tTxt}, ${pText}${dzTxt}.`;
    }
    return `A paired-samples t test was conducted to compare ${dv} between ${c1} and ${c2}. ` +
           `Scores were ${m1} (SD = ${sd1}) at ${c1} and ${m2} (SD = ${sd2}) at ${c2}. ` +
           `The test yielded t(${df}) = ${tTxt}, ${pText}${dzTxt}.`;
  }

  function genRegSimple(style) {
    const dv = $("r_dv").value.trim() || "the DV";
    const iv = $("r_iv").value.trim() || "the IV";
    const b = num($("r_b").value);
    const se = num($("r_se").value);
    const tVal = num($("r_t").value);
    const df = fmtDfInt($("r_df").value);
    const pText = fmtP($("r_p").value);
    const r2 = num($("r_r2").value);
    const f = num($("r_f").value);

    if (b === null || tVal === null || !df || pText === null) {
      return "Please enter at least b, t, df, and p (SE, R², and F are optional).";
    }

    const bTxt = fmtFixed(b, 2);                 // unbounded -> keep leading zero if any
    const seTxt = (se !== null) ? `, SE = ${fmtFixed(se, 2)}` : "";
    const r2Txt = (r2 !== null) ? `, R² = ${fmtBounded(r2, 2)}` : "";
    const fTxt = (f !== null && r2 !== null) ? `, F(1, ${df}) = ${fmtFixed(f, 2)}` : "";

    if (style === "sentence") {
      return `A simple linear regression predicting ${dv} from ${iv} yielded b = ${bTxt}${seTxt}, t(${df}) = ${fmtFixed(tVal, 2)}, ${pText}${r2Txt}${fTxt}.`;
    }
    return `A simple linear regression was conducted to test whether ${iv} predicted ${dv}. ` +
           `The model yielded b = ${bTxt}${seTxt}, t(${df}) = ${fmtFixed(tVal, 2)}, ${pText}${r2Txt}${fTxt}.`;
  }

  function generate() {
    const test = $("test").value;
    const style = $("style").value;
    if (test === "corr") return genCorrelation(style);
    if (test === "ztest_one") return genZTestOne(style);
    if (test === "ttest_ind") return genTTestInd(style);
    if (test === "ttest_paired") return genTTestPaired(style);
    if (test === "reg_simple") return genRegSimple(style);
    return "Select a test.";
  }

  $("test").addEventListener("change", (e) => showPanel(e.target.value));
  $("gen").addEventListener("click", () => { $("out").value = generate(); });

  $("copy").addEventListener("click", async () => {
    const text = $("out").value.trim();
    if (!text) return;
    try {
      await navigator.clipboard.writeText(text);
      $("copy").textContent = "Copied!";
      setTimeout(() => $("copy").textContent = "Copy", 900);
    } catch {
      alert("Copy failed — select the text and copy manually.");
    }
  });

  $("clear").addEventListener("click", () => {
    document.querySelectorAll("input").forEach(i => i.value = "");
    $("out").value = "";
  });

  // init
  showPanel($("test").value);
</script>
</body>
</html>
